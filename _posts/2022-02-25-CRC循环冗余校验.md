---
layout:     post
title:      CRC校验算法
subtitle:   
date:       2022-02-25
author:     Aiden
header-img: img/post-bg-swift.jpg
catalog: true  
tags:
    - 算法
---

### 背景

![image.png]({{ site.url }}/assets/crc_1_1.png)

CRC即循环冗余校验码：是数据通信领域中最常用的一种**查错校验码**，其特征是**信息字段**和**校验字段**的长度可以任意选定。

循环冗余检查（CRC）是一种数据传输检错功能，对数据进行多项式计算，并将得到的结果附在帧的后面，接收设备也执行类似的算法，以保证数据传输的正确性和完整性。

其根本思想就是**先在要发送的数据字节流后面附加几个校验位**，生成一个新的字节流发送给接收端。

校验位的生成是通过一个 **模二除法** 计算得到的。

数据到达接收端后，再把接收到的数据流(**原数据+校验码**)同样进行**模二除法**。这时结果应该是没有余数。如果有余数，则表明该帧在传输过程中出现了差错, 由此实现了数据校验。

![image.png]({{ site.url }}/assets/crc_1_2.png)

**校验码计算方式**

1. 对于任意需要添加校验的字节流，**我们人为选择一个合适的二进制`除数G`**
2. 假设`除数G`有`k`位, 则**将需要校验的字节流后面补`(k-1)`位`0`作为被除数`M`**
3. 将`被除数M`与`除数G`进行**模二除法**(模2除法与算术除法类似，但每一位除的结果不影响其它位，即不向上一位借位，所以实际上就是**异或**)
4. 将模二除法得到 **`(k-1)`位余数** (不足`(k-1)`位高位用`0`不足)便是校验字节流的**CRC冗余码**。

### CRC多项式(除数)

CRC 多项式是除数的一种表达形式:

对于 $G(x)=x^{4}+x^{3}+1$ 的形式，其标识除数为`11001`

CRC多项式的设计要考虑很多因素，如选择的多项式必须有最大的错误检测能力，同时保证总体的碰撞概率最小等，这里就不再多讲述，可参考下面的链接。

[Cyclic redundancy check](https://en.wikipedia.org/wiki/Cyclic_redundancy_check)

![image.png]({{ site.url }}/assets/crc_1_3.webpp)

### CRC 实现方式

一般来说CRC有多种实现方式，主要列举有 **直接生成法** 和 **查表法** 两种。

**直接生成法** 适用于**CRC次幂较小**的格式，当CRC次幂逐渐增高时，因为其复杂的 Xor 逻辑运算会拖累系统运行速度，不再建议使用直接生成法，取而代之的是**查表法**。

**查表法**是将`数据块M`的一部分提前运算好，并将结果存入数组中，系统开始执行运算时，相当于省去了之前的操作，直接从类似中间的位置开始计算，所以会提高效率。

在计算CRC时也可以选择 **正向校验(Normal)** 或者 **反向校验(Reversed)**，由于 `Normal` 和 `Reversed` 是镜像关系，两种方法会影响到最后的校验码，使得两种方式最后得到的校验码呈现镜像关系。 

但这对CRC 本身的成功率并没有影响，只不过是: 正向走一遍，还是镜像走一遍罢了。

那为什么还会有 Reversed 格式呢？ 是因为在大多数硬件系统的传输中，普遍先发送LSB，而Reversed 的CRC 正是满足于这种 LSB First 的格式，因此适用。

#### 直接生成法


